<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pemilihan RT/RW Desa Sukamaju</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        /* Background Desa dengan tema hijau - Optimized */
        .hero {
            height: 100vh;
            background: linear-gradient(rgba(46, 125, 50, 0.7), rgba(27, 94, 32, 0.8)),
                        url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&q=75&auto=format') center/cover no-repeat;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            position: relative;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            animation: fadeInUp 1s ease-out;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            max-width: 600px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            animation: fadeInUp 1s ease-out 0.3s both;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info span {
            color: white;
            font-weight: 600;
        }

        .logout-btn {
            background: rgba(244, 67, 54, 0.8);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(244, 67, 54, 1);
            transform: scale(1.05);
        }

        .cta-button {
            display: inline-block;
            background: linear-gradient(45deg, #66BB6A, #4CAF50);
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            animation: fadeInUp 1s ease-out 0.6s both;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #4CAF50, #388E3C);
        }

        /* Section Calon */
        .candidates {
            padding: 80px 20px;
            background: linear-gradient(135deg, #E8F5E8 0%, #F1F8E9 100%);
            position: relative;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: #2E7D32;
        }

        /* Horizontal carousel for candidate cards */
        .candidates-carousel-wrapper {
            position: relative;
            margin-top: 50px;
            display: flex;
            align-items: center;
        }
        .candidates-carousel {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 30px;
            scroll-behavior: smooth;
            width: 100%;
            padding-bottom: 10px;
        }
        .candidates-carousel::-webkit-scrollbar {
            display: none;
        }
        .candidate-card {
            flex: 0 0 auto;
            scroll-snap-align: start;
        }
        .carousel-arrow {
            background: linear-gradient(45deg, #4CAF50, #388E3C);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: background 0.3s;
            z-index: 10;
        }
        .carousel-arrow:hover {
            background: linear-gradient(45deg, #388E3C, #2E7D32);
        }
        .carousel-arrow.left {
            margin-right: 10px;
        }
        .carousel-arrow.right {
            margin-left: 10px;
        }

        /* Hide the original grid of candidates (static fallback) */
        .candidates-grid {
            display: none;
        }

        .candidate-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(46, 125, 50, 0.1);
            transition: all 0.3s ease;
            position: relative;
            transform: translateY(0);
            width: 320px; /* fixed width for horizontal carousel */
            max-width: 320px;
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .candidate-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(46, 125, 50, 0.2);
        }

        .candidate-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #66BB6A, #4CAF50);
            position: relative;
            overflow: hidden;
        }

        .candidate-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            loading: lazy;
        }

        .candidate-info {
            padding: 25px;
            text-align: center;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .candidate-content {
            flex-grow: 1;
        }

        .candidate-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2E7D32;
            margin-bottom: 10px;
        }

        .candidate-position {
            color: #66BB6A;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            background: rgba(102, 187, 106, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        .candidate-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .vote-button {
            background: linear-gradient(45deg, #4CAF50, #388E3C);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: auto;
        }

        .vote-button:hover {
            transform: scale(1.05);
            background: linear-gradient(45deg, #388E3C, #2E7D32);
        }

        .vote-button.voted {
            background: linear-gradient(45deg, #66BB6A, #4CAF50);
            cursor: not-allowed;
        }

        .vote-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Footer dengan tema hijau desa */
        .footer {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }

        .footer h3 {
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .footer p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
                padding: 0 20px;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .candidates-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                justify-items: center;
            }

            .candidate-card {
                max-width: 100%;
                height: auto;
                min-height: 450px;
            }

            .user-info {
                top: 10px;
                right: 10px;
                padding: 8px 15px;
                font-size: 0.9rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal-content {
            background: #fff;
            border-radius: 10px;
            padding: 30px 25px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
        }
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            background: linear-gradient(45deg, #4CAF50, #388E3C);
            color: #fff;
        }
        .modal-button:hover {
            background: linear-gradient(45deg, #388E3C, #2E7D32);
        }
        .modal-button.secondary {
            background: linear-gradient(45deg, #E53935, #D32F2F);
        }
        .modal-button.secondary:hover {
            background: linear-gradient(45deg, #D32F2F, #C62828);
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <div id="userInfo" class="user-info" style="display: none;">
            <span id="userDisplay"></span>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <h1>Pemilihan RT/RW Desa Sukamaju</h1>
        <p>Pilih pemimpin RT/RW yang akan membawa kemajuan untuk lingkungan kita. Voting berlangsung dari 1-15 Desember 2024.</p>
        <div class="cta-buttons">
            <a href="#candidates" class="cta-button">Lihat Calon</a>
            <a href="statistik.html" class="cta-button cta-secondary">Statistik</a>
        </div>
    </section>
    
    <!-- Candidates Section -->
    <section id="candidates" class="candidates">
        <div class="container">
            <h2 class="section-title">Calon RT/RW</h2>
            <div class="candidates-grid" id="candidateGrid">
                <!-- Static fallback list hidden -->
            </div>
            <!-- Horizontal scrollable carousel for candidates -->
            <div class="candidates-carousel-wrapper">
                <button class="carousel-arrow left" onclick="scrollCarousel(-1)">←</button>
                <div class="candidates-carousel" id="candidateCarousel">
                    <!-- Candidate cards will be injected here via JS -->
                </div>
                <button class="carousel-arrow right" onclick="scrollCarousel(1)">→</button>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <h3>Desa Sukamaju</h3>
        <p>Bersama membangun desa yang lebih maju dan sejahtera</p>
        <p>&copy; 2024 Pemilihan RT/RW Desa Sukamaju. Semua hak cipta dilindungi.</p>
    </footer>

    <!-- Custom Modal for alerts and confirmations -->
    <div id="customModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <div id="modalMessage"></div>
            <div id="modalButtons" class="modal-buttons"></div>
        </div>
    </div>

    <script>
        // ===== Utility functions for modal popups =====
        const modal = document.getElementById('customModal');
        const modalMessage = document.getElementById('modalMessage');
        const modalButtons = document.getElementById('modalButtons');
        /** Show a simple alert modal */
        function showAlert(message, callback) {
            modalMessage.innerHTML = message;
            modalButtons.innerHTML = '<button class="modal-button" id="modalOkBtn">OK</button>';
            modal.style.display = 'flex';
            document.getElementById('modalOkBtn').onclick = function() {
                modal.style.display = 'none';
                if (callback) callback();
            };
        }
        /** Show a confirm modal with Yes/No buttons */
        function showConfirm(message, onResult) {
            modalMessage.innerHTML = message;
            modalButtons.innerHTML = '<button class="modal-button" id="modalYesBtn">Ya</button><button class="modal-button secondary" id="modalNoBtn">Tidak</button>';
            modal.style.display = 'flex';
            document.getElementById('modalYesBtn').onclick = function() {
                modal.style.display = 'none';
                if (onResult) onResult(true);
            };
            document.getElementById('modalNoBtn').onclick = function() {
                modal.style.display = 'none';
                if (onResult) onResult(false);
            };
        }

        // ===== Candidate management functions =====
        // Default candidates (same as admin panel)
        const DEFAULT_CANDIDATES = [
            { id:'budi', name:'Budi Santoso', position:'Calon Ketua RT 01', category:'rt', image:'https://i.pravatar.cc/400?img=12', description:'Pengalaman 10 tahun sebagai pengurus RT. Fokus pada peningkatan fasilitas umum, keamanan lingkungan, dan pemberdayaan warga.' },
            { id:'siti', name:'Siti Aminah', position:'Calon Ketua RT 01', category:'rt', image:'https://i.pravatar.cc/400?img=47', description:'Aktif dalam kegiatan sosial dan pendidikan anak. Visi: Menciptakan lingkungan yang ramah anak dan mendukung UMKM lokal.' },
            { id:'joko', name:'Joko Widodo', position:'Calon Ketua RT 01', category:'rt', image:'https://i.pravatar.cc/400?img=33', description:'Petani sukses dengan visi pembangunan pertanian berkelanjutan. Program: Irigasi modern dan pelatihan pertanian untuk warga muda.' },
            { id:'ahmad', name:'Ahmad Wijaya', position:'Calon Ketua RW 03', category:'rw', image:'https://i.pravatar.cc/400?img=15', description:'Pengusaha lokal dengan pengalaman kepemimpinan. Program prioritas: Infrastruktur jalan, drainase, dan pengelolaan sampah terpadu.' },
            { id:'rina', name:'Rina Kartika', position:'Calon Ketua RW 03', category:'rw', image:'https://i.pravatar.cc/400?img=44', description:'Profesional IT yang peduli lingkungan. Inisiatif digitalisasi administrasi RW dan program pelatihan digital untuk warga.' },
            { id:'dewi', name:'Dewi Lestari', position:'Calon Ketua RW 03', category:'rw', image:'https://i.pravatar.cc/400?img=68', description:'Guru dan aktivis lingkungan. Program unggulan: Bank sampah, taman hijau RT/RW, dan pemberdayaan ibu rumah tangga melalui kerajinan.' }
        ];
        /** Retrieve candidate list from localStorage or fallback to default */
        function getCandidateList() {
            const stored = localStorage.getItem('adminCandidates');
            if (stored) {
                try {
                    const parsed = JSON.parse(stored);
                    // If the stored data is a non-empty array, return it
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        return parsed;
                    }
                } catch (e) {
                    // Data might be corrupted, remove it so we can reset
                    localStorage.removeItem('adminCandidates');
                }
            }
            // No valid stored list; save the default list so other pages see it too
            localStorage.setItem('adminCandidates', JSON.stringify(DEFAULT_CANDIDATES));
            return [...DEFAULT_CANDIDATES];
        }

        /** Global array to store candidate IDs for easier iteration */
        let candidateIds = [];

        /** Render candidate cards dynamically based on stored data */
        function renderCandidates() {
            const list = getCandidateList();
            candidateIds = list.map(c => c.id);
            // Use the horizontal carousel container instead of the hidden grid
            const grid = document.getElementById('candidateCarousel');
            if (!grid) return;
            // Remove existing content
            grid.innerHTML = '';
            list.forEach((cand) => {
                // Card container
                const card = document.createElement('div');
                card.className = 'candidate-card';
                // Image wrapper
                const imgWrapper = document.createElement('div');
                imgWrapper.className = 'candidate-image';
                const img = document.createElement('img');
                img.src = cand.image;
                img.alt = cand.name;
                imgWrapper.appendChild(img);
                card.appendChild(imgWrapper);
                // Info container
                const info = document.createElement('div');
                info.className = 'candidate-info';
                // Content for name, position and description
                const contentDiv = document.createElement('div');
                contentDiv.className = 'candidate-content';
                const nameEl = document.createElement('h3');
                nameEl.className = 'candidate-name';
                nameEl.textContent = cand.name;
                const posEl = document.createElement('div');
                posEl.className = 'candidate-position';
                posEl.textContent = cand.position;
                const descEl = document.createElement('p');
                descEl.className = 'candidate-description';
                descEl.textContent = cand.description || '';
                contentDiv.appendChild(nameEl);
                contentDiv.appendChild(posEl);
                contentDiv.appendChild(descEl);
                info.appendChild(contentDiv);
                // Button
                const btn = document.createElement('button');
                btn.className = 'vote-button';
                btn.id = 'btn-' + cand.id;
                btn.dataset.candidateName = cand.name;
                btn.onclick = function() { voteCandidate(cand.name, cand.id); };
                // Span for button text
                const spanText = document.createElement('span');
                spanText.id = 'btn-text-' + cand.id;
                spanText.textContent = 'Vote';
                // Loading spinner
                const spanLoad = document.createElement('span');
                spanLoad.id = 'loading-' + cand.id;
                spanLoad.className = 'loading';
                spanLoad.style.display = 'none';
                // Append spans to button
                btn.appendChild(spanText);
                btn.appendChild(spanLoad);
                info.appendChild(btn);
                card.appendChild(info);
                grid.appendChild(card);
            });
            // After rendering, update vote status if necessary
            checkVotedStatus();
        }

        // ===== End of helper functions =====

        // Check if user is logged in
        window.addEventListener('load', function() {
            // Always render candidates from storage
            renderCandidates();
            const loggedUser = localStorage.getItem('loggedInUser');
            if (loggedUser) {
                const user = JSON.parse(loggedUser);
                document.getElementById('userDisplay').textContent = `NIK: ${user.nik} | RT ${user.rt}/RW ${user.rw}`;
                document.getElementById('userInfo').style.display = 'flex';
            } else {
                // hide user info if not logged in
                document.getElementById('userInfo').style.display = 'none';
            }
            // Update button states based on voting
            checkVotedStatus();
        });

        function checkVotedStatus() {
            /*
             * Perbarui status tombol vote berdasarkan kondisi login dan riwayat voting.
             * - Jika pengguna belum login, semua tombol Vote kembali aktif dengan label "Vote".
             * - Jika pengguna sudah login dan sudah memilih kandidat, tombol kandidat yang dipilih
             *   menampilkan "Voted" dan kandidat lain menampilkan "Voting Closed".
             * - Jika pengguna login tapi belum memilih kandidat, semua tombol Vote aktif.
             */
            const loggedUser = localStorage.getItem('loggedInUser');
            const votedFor = localStorage.getItem('votedFor');
            candidateIds.forEach(id => {
                const btn = document.getElementById('btn-' + id);
                if (!btn) return;
                const btnText = document.getElementById('btn-text-' + id);
                // Jika belum login, semua tombol aktif tanpa status voting
                if (!loggedUser) {
                    btn.disabled = false;
                    btnText.textContent = 'Vote';
                    btn.classList.remove('voted');
                    return;
                }
                // Jika sudah login
                if (votedFor) {
                    // Jika sudah vote, nonaktifkan semua tombol
                    btn.disabled = true;
                    const candidateName = btn.dataset.candidateName;
                    if (candidateName === votedFor) {
                        btnText.textContent = 'Voted ✓';
                        btn.classList.add('voted');
                    } else {
                        btnText.textContent = 'Voting Closed';
                    }
                } else {
                    // Belum vote, semua tombol aktif
                    btn.disabled = false;
                    btnText.textContent = 'Vote';
                    btn.classList.remove('voted');
                }
            });
        }

        function voteCandidate(name, id) {
            const loggedUser = localStorage.getItem('loggedInUser');
            if (!loggedUser) {
                // Redirect unauthenticated users to login
                window.location.href = 'login.html';
                return;
            }
            // Prevent double voting
            const votedFor = localStorage.getItem('votedFor');
            if (votedFor) {
                showAlert(`Anda sudah memberikan vote untuk ${votedFor}. Setiap pemilih hanya dapat vote 1 kali.`);
                return;
            }
            // Process vote
            const btnText = document.getElementById('btn-text-' + id);
            const loading = document.getElementById('loading-' + id);
            const btn = document.getElementById('btn-' + id);
            // Show loading indicator
            btnText.style.display = 'none';
            loading.style.display = 'inline-block';
            btn.disabled = true;
            // Simulate voting with a delay
            setTimeout(() => {
                loading.style.display = 'none';
                btnText.textContent = 'Voted ✓';
                btnText.style.display = 'inline';
                btn.classList.add('voted');
                // Save vote information
                localStorage.setItem('votedFor', name);
                updateVotingStatistics(id);
                // Disable all other buttons
                candidateIds.forEach(candidateId => {
                    const otherBtn = document.getElementById('btn-' + candidateId);
                    if (!otherBtn) return;
                    if (candidateId !== id) {
                        otherBtn.disabled = true;
                        const otherText = document.getElementById('btn-text-' + candidateId);
                        if (otherText) otherText.textContent = 'Voting Closed';
                    }
                });
                // Show success alert
                showAlert(`Terima kasih! Vote Anda untuk ${name} telah tercatat.`);
            }, 1500);
        }
        
        // Update voting statistics
        function updateVotingStatistics(candidateId) {
            // Get existing voting data or create new one
            const votingData = JSON.parse(localStorage.getItem('votingData') || '{}');
            
            // Increment vote count for the candidate
            if (votingData[candidateId]) {
                votingData[candidateId] += 1;
            } else {
                votingData[candidateId] = 1;
            }
            
            // Save updated voting data
            localStorage.setItem('votingData', JSON.stringify(votingData));
            
            // Also save the total votes count
            const totalVotes = Object.values(votingData).reduce((sum, count) => sum + count, 0);
            localStorage.setItem('totalVotes', totalVotes.toString());
        }

        function logout() {
            showConfirm('Apakah Anda yakin ingin logout?', function(result) {
                if (result) {
                    localStorage.removeItem('loggedInUser');
                    window.location.href = 'login.html';
                }
            });
        }

        // Scroll the candidate carousel left or right
        function scrollCarousel(direction) {
            const carousel = document.getElementById('candidateCarousel');
            if (!carousel) return;
            const card = carousel.querySelector('.candidate-card');
            // Determine width of a single card; fallback to 320px if not rendered yet
            const cardWidth = card ? card.offsetWidth : 320;
            const gap = 30;
            const scrollAmount = cardWidth + gap;
            carousel.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
        }

        // Smooth scrolling for CTA button
        document.querySelector('.cta-button').addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('#candidates').scrollIntoView({
                behavior: 'smooth'
            });
        });
    </script>
</body>
</html>